<!--
  TEMPLATE: Formulario Accesible

  Este template demuestra las mejores practicas para formularios accesibles
  incluyendo labels, errores inline, autocomplete, y estados de validacion.

  Reglas aplicadas:
  - A002: Labels en controles de formulario
  - FM001: Autocomplete significativo
  - FM003: No bloquear paste
  - FM008: Errores inline junto a campos
  - FM011: Advertencia de cambios sin guardar
-->

<!-- ============================================== -->
<!-- FORMULARIO DE CONTACTO COMPLETO -->
<!-- ============================================== -->

<form id="contact-form" class="form" novalidate>
  <!-- Campo de texto con label -->
  <div class="form-field">
    <label for="name" class="form-label">
      Nombre completo
      <span class="required" aria-hidden="true">*</span>
    </label>
    <input
      type="text"
      id="name"
      name="name"
      autocomplete="name"
      required
      aria-required="true"
      aria-describedby="name-hint"
      class="form-input"
      placeholder="Juan Perez"
    >
    <span id="name-hint" class="form-hint">
      Tu nombre como aparecera en la comunicacion
    </span>
    <span id="name-error" class="form-error" role="alert" aria-live="polite"></span>
  </div>

  <!-- Campo de email -->
  <div class="form-field">
    <label for="email" class="form-label">
      Correo electronico
      <span class="required" aria-hidden="true">*</span>
    </label>
    <input
      type="email"
      id="email"
      name="email"
      autocomplete="email"
      required
      aria-required="true"
      inputmode="email"
      class="form-input"
      placeholder="juan@ejemplo.com"
    >
    <span id="email-error" class="form-error" role="alert" aria-live="polite"></span>
  </div>

  <!-- Campo de telefono -->
  <div class="form-field">
    <label for="phone" class="form-label">Telefono</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      autocomplete="tel"
      inputmode="tel"
      class="form-input"
      placeholder="+52 555 123 4567"
    >
  </div>

  <!-- Textarea -->
  <div class="form-field">
    <label for="message" class="form-label">
      Mensaje
      <span class="required" aria-hidden="true">*</span>
    </label>
    <textarea
      id="message"
      name="message"
      required
      aria-required="true"
      rows="4"
      class="form-input form-textarea"
      placeholder="Escribe tu mensaje aqui..."
    ></textarea>
    <span id="message-error" class="form-error" role="alert" aria-live="polite"></span>
  </div>

  <!-- Select -->
  <div class="form-field">
    <label for="subject" class="form-label">Asunto</label>
    <select id="subject" name="subject" class="form-input form-select">
      <option value="">Selecciona un asunto</option>
      <option value="general">Consulta general</option>
      <option value="support">Soporte tecnico</option>
      <option value="sales">Ventas</option>
    </select>
  </div>

  <!-- Checkbox -->
  <div class="form-field form-checkbox-field">
    <input
      type="checkbox"
      id="newsletter"
      name="newsletter"
      class="form-checkbox"
    >
    <label for="newsletter" class="form-checkbox-label">
      Deseo recibir noticias y actualizaciones
    </label>
  </div>

  <!-- Submit -->
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">
      Enviar mensaje
    </button>
    <button type="reset" class="btn btn-secondary">
      Limpiar
    </button>
  </div>
</form>

<style>
/* ============================================== */
/* ESTILOS BASE DEL FORMULARIO */
/* ============================================== */

.form {
  max-width: 32rem;
  margin: 0 auto;
}

.form-field {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
}

.required {
  color: #dc2626;
  margin-left: 0.25rem;
}

.form-input {
  display: block;
  width: 100%;
  padding: 0.75rem 1rem;
  font-size: 1rem;
  line-height: 1.5;
  color: #1f2937;
  background-color: #fff;
  border: 1px solid #d1d5db;
  border-radius: 0.5rem;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.form-input::placeholder {
  color: #9ca3af;
}

/* Focus state */
.form-input:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

/* Error state */
.form-input[aria-invalid="true"],
.form-input.is-invalid {
  border-color: #dc2626;
}

.form-input[aria-invalid="true"]:focus,
.form-input.is-invalid:focus {
  box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.2);
}

/* Hint text */
.form-hint {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: #6b7280;
}

/* Error message */
.form-error {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.875rem;
  color: #dc2626;
}

.form-error:empty {
  display: none;
}

/* Textarea */
.form-textarea {
  resize: vertical;
  min-height: 8rem;
}

/* Select */
.form-select {
  appearance: none;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  background-position: right 0.75rem center;
  background-repeat: no-repeat;
  background-size: 1.5rem;
  padding-right: 2.5rem;
}

/* Checkbox */
.form-checkbox-field {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.form-checkbox {
  width: 1.25rem;
  height: 1.25rem;
  accent-color: #3b82f6;
  cursor: pointer;
}

.form-checkbox:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

.form-checkbox-label {
  margin: 0;
  cursor: pointer;
}

/* Actions */
.form-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
}

/* Buttons (basicos) */
.btn {
  padding: 0.75rem 1.5rem;
  font-weight: 500;
  border-radius: 0.5rem;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-primary {
  background: #3b82f6;
  color: white;
  border: none;
}

.btn-primary:hover {
  background: #2563eb;
}

.btn-primary:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
}

.btn-secondary {
  background: #e5e7eb;
  color: #374151;
  border: none;
}

.btn-secondary:hover {
  background: #d1d5db;
}

/* Dark mode */
@media (prefers-color-scheme: dark) {
  .form-label {
    color: #e5e7eb;
  }

  .form-input {
    background-color: #1f2937;
    border-color: #4b5563;
    color: #f9fafb;
  }

  .form-input:focus {
    border-color: #60a5fa;
  }

  .form-hint {
    color: #9ca3af;
  }
}
</style>

<script>
// ============================================== */
// VALIDACION Y MANEJO DE ERRORES */
// ============================================== */

document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('contact-form');
  let formChanged = false;

  // Track changes for unsaved warning
  form.addEventListener('input', function() {
    formChanged = true;
  });

  // Warn before leaving with unsaved changes
  window.addEventListener('beforeunload', function(e) {
    if (formChanged) {
      e.preventDefault();
      e.returnValue = '';
    }
  });

  // Validation on submit
  form.addEventListener('submit', function(e) {
    e.preventDefault();

    const errors = validateForm();

    if (errors.length > 0) {
      // Focus first field with error
      const firstError = document.getElementById(errors[0].field);
      if (firstError) {
        firstError.focus();
      }
      return;
    }

    // Form is valid
    formChanged = false;
    console.log('Form submitted successfully');
  });

  function validateForm() {
    const errors = [];

    // Clear previous errors
    document.querySelectorAll('.form-error').forEach(el => el.textContent = '');
    document.querySelectorAll('.form-input').forEach(el => el.removeAttribute('aria-invalid'));

    // Validate name
    const name = document.getElementById('name');
    if (!name.value.trim()) {
      showError('name', 'El nombre es requerido');
      errors.push({ field: 'name' });
    }

    // Validate email
    const email = document.getElementById('email');
    if (!email.value.trim()) {
      showError('email', 'El correo electronico es requerido');
      errors.push({ field: 'email' });
    } else if (!isValidEmail(email.value)) {
      showError('email', 'Ingresa un correo electronico valido');
      errors.push({ field: 'email' });
    }

    // Validate message
    const message = document.getElementById('message');
    if (!message.value.trim()) {
      showError('message', 'El mensaje es requerido');
      errors.push({ field: 'message' });
    }

    return errors;
  }

  function showError(fieldId, message) {
    const field = document.getElementById(fieldId);
    const errorEl = document.getElementById(fieldId + '-error');

    field.setAttribute('aria-invalid', 'true');
    field.setAttribute('aria-describedby', fieldId + '-error');

    if (errorEl) {
      errorEl.textContent = message;
    }
  }

  function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }
});
</script>
